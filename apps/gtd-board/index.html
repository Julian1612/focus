<style>
    /*
    * FocusOS GTD Board - Final Version
    * Design Refinement: Footer Buttons
    */
    :root {
        --gtd-column-color: #232327;
        --gtd-border-subtle: rgba(255, 255, 255, 0.07);
        --gtd-shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.2);
        --gtd-shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -2px rgba(0, 0, 0, 0.2);
    }

    /* --- Base Layout --- */
    .gtd-board-wrapper { height: 100%; width: 100%; box-sizing: border-box; background-color: var(--bg-color); padding: 16px 24px; display: flex; flex-direction: column; }
    .gtd-board-columns { flex-grow: 1; display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; min-height: 0; }
    .gtd-column { display: flex; flex-direction: column; background-color: var(--gtd-column-color); border-radius: 12px; max-height: 100%; }
    .gtd-column-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-bottom: 1px solid var(--gtd-border-subtle); flex-shrink: 0; }
    .gtd-column-header h3 { margin: 0; font-size: 1rem; font-weight: 500; color: var(--text-primary); }
    .gtd-task-count { font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); background-color: var(--bg-color); padding: 2px 8px; border-radius: 8px; }
    .task-list { list-style: none; margin: 0; padding: 8px; overflow-y: auto; flex-grow: 1; min-height: 0; }
    .task-list::-webkit-scrollbar { width: 8px; }
    .task-list::-webkit-scrollbar-track { background: transparent; }
    .task-list::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 4px; }

    /* --- Task Card --- */
    .task-card { background-color: var(--card-color); border-radius: 8px; padding: 12px; margin-bottom: 8px; border: 1px solid var(--border-color); font-size: 0.95rem; color: var(--text-primary); cursor: pointer; word-wrap: break-word; box-shadow: var(--gtd-shadow-sm); transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease; }
    .task-card:hover { transform: translateY(-2px); box-shadow: var(--gtd-shadow-md); border-color: var(--accent-color); }
    .category-pill { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; color: #fff; text-transform: uppercase; }
    .category--work { background-color: #5e5ce6; } .category--personal { background-color: #32d74b; } .category--study { background-color: #64d2ff; } .category--urgent { background-color: #ff9f0a; }
    .due-date-badge { display: flex; align-items: center; gap: 6px; font-size: 0.8rem; font-weight: 500; border-radius: 6px; padding: 3px 8px; margin-top: 10px; width: fit-content; }
    .due-date-badge::before { content: ''; display: block; width: 8px; height: 8px; border-radius: 50%; background-color: currentColor; }
    .due-date-badge { color: var(--text-secondary); } .due-date-badge--today { color: #ff9f0a; } .due-date-badge--overdue { color: #ff453a; }
    .subtask-progress { display: flex; align-items: center; gap: 8px; margin-top: 10px; }
    .subtask-progress-bar-container { flex-grow: 1; background-color: var(--gtd-column-color); height: 6px; border-radius: 3px; overflow: hidden; }
    .subtask-progress-bar { background-color: var(--text-secondary); height: 100%; width: 0%; transition: width 0.3s ease; }
    .subtask-progress-text { font-size: 0.75rem; font-weight: 500; color: var(--text-secondary); }

    /* --- Modals --- */
    .gtd-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(5px); opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
    .gtd-modal-overlay.visible { opacity: 1; visibility: visible; }
    .gtd-modal-content { background-color: var(--gtd-column-color); border-radius: 12px; width: 90%; padding: 24px 28px; border: 1px solid var(--gtd-border-subtle); box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative; transform: scale(0.95); transition: transform 0.3s ease; }
    .gtd-modal-overlay.visible .gtd-modal-content { transform: scale(1); }
    .gtd-modal-close-btn { position: absolute; top: 16px; right: 16px; background: none; border: none; color: var(--text-secondary); font-size: 1.8rem; line-height: 1; cursor: pointer; padding: 0; transition: color 0.2s ease, transform 0.2s ease; }
    .gtd-modal-close-btn:hover { color: var(--text-primary); transform: scale(1.1); }
    .gtd-modal-label { font-size: 0.9rem; font-weight: 500; color: var(--text-secondary); margin: 20px 0 10px 0; display: block; }
    .gtd-category-selector { display: flex; flex-wrap: wrap; gap: 8px; }
    .gtd-category-option { background-color: transparent; border: 2px solid var(--border-color); color: var(--text-secondary); border-radius: 8px; padding: 6px 12px; font-size: 0.9rem; cursor: pointer; transition: all 0.2s ease; }
    .gtd-category-option.active { border-color: currentColor; background-color: var(--card-color); color: var(--text-primary); font-weight: 500; }
    
    /* --- Detail Modal --- */
    #gtd-task-modal .gtd-modal-content { max-width: 680px; }
    .gtd-modal-title { font-size: 1.5rem; font-weight: 600; margin: 0 0 24px 0; width: calc(100% - 40px); color: var(--text-primary); }
    .gtd-modal-duedate { background-color: var(--card-color); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); padding: 10px 12px; font-family: inherit; font-size: 0.95rem; }
    .gtd-modal-notes { background-color: var(--card-color); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); width: 100%; height: 100px; padding: 12px; font-family: inherit; font-size: 1rem; resize: vertical; box-sizing: border-box; }
    .gtd-subtask-list { list-style: none; margin: 10px 0 0 0; padding: 0; max-height: 150px; overflow-y: auto; }
    .gtd-subtask-item { display: flex; align-items: center; gap: 12px; padding: 8px; border-radius: 6px; transition: background-color 0.2s ease; }
    .gtd-subtask-item:hover { background-color: rgba(255,255,255,0.05); }
    .gtd-subtask-item input[type="checkbox"] { width: 18px; height: 18px; flex-shrink: 0; accent-color: var(--accent-color); }
    .gtd-subtask-text { flex-grow: 1; color: var(--text-primary); font-size: 0.95rem; }
    .gtd-subtask-item.completed .gtd-subtask-text { text-decoration: line-through; color: var(--text-secondary); }
    .gtd-subtask-duedate { background-color: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-secondary); border-radius: 6px; font-size: 0.8rem; padding: 4px 6px; }
    .gtd-subtask-delete-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; opacity: 0.5; transition: opacity 0.2s ease; }
    .gtd-subtask-item:hover .gtd-subtask-delete-btn { opacity: 1; }
    .gtd-add-subtask-form { display: flex; gap: 8px; margin-top: 12px; }
    .gtd-add-subtask-form input[type="text"] { flex-grow: 1; background-color: var(--card-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 8px 12px; color: var(--text-primary); }
    .gtd-add-subtask-form button { background-color: var(--accent-color); color: white; border: none; border-radius: 8px; padding: 0 16px; cursor: pointer; }

    /* --- Composer Modal --- */
    #gtd-composer-modal .gtd-modal-content { max-width: 560px; display: flex; flex-direction: column; min-height: 190px; }
    #gtd-composer-task-name { width: 100%; font-size: 1.25rem; font-weight: 500; background-color: transparent; border: none; border-bottom: 2px solid var(--border-color); color: var(--text-primary); padding: 8px 0; transition: border-color 0.2s ease; }
    .gtd-composer-pickers { flex-grow: 1; position: relative; padding-top: 16px; }
    .gtd-composer-pickers > * { position: absolute; width: 100%; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease; }
    .gtd-composer-pickers > *.visible { opacity: 1; visibility: visible; transform: translateY(0); }
    .gtd-composer-options { display: flex; justify-content: space-between; align-items: center; margin-top: 16px; }
    .gtd-composer-meta-buttons { display: flex; gap: 8px; }
    .gtd-composer-meta-buttons button { background-color: var(--card-color); border: 1px solid var(--border-color); color: var(--text-secondary); border-radius: 8px; padding: 8px 12px; cursor: pointer; transition: all 0.2s ease; }
    .gtd-composer-meta-buttons button:hover { border-color: var(--text-secondary); color: var(--text-primary); }
    .gtd-composer-meta-buttons button.active { border-color: var(--accent-color); color: var(--accent-color); background-color: var(--gtd-column-color); }
    #gtd-composer-add-btn { background-color: var(--accent-color); color: white; padding: 10px 20px; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; transition: background-color 0.2s ease; }
    #gtd-composer-add-btn:disabled { background-color: var(--border-color); color: var(--text-secondary); cursor: not-allowed; }
    
    /* --- DESIGN FIX: Footer & Add Button --- */
    .column-footer {
        padding: 0 8px 8px 8px;
        flex-shrink: 0;
    }
    .add-task-btn {
        background-color: transparent;
        border: 1px dashed var(--border-color);
        color: var(--text-secondary);
        border-radius: 8px;
        width: 100%;
        padding: 10px;
        font-size: 0.9rem;
        font-weight: 500;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    .add-task-btn:hover {
        background-color: rgba(175, 82, 222, 0.1);
        border-color: var(--accent-color);
        border-style: solid;
        color: var(--accent-color);
    }
</style>

<div class="gtd-board-wrapper">
    <main class="gtd-board-columns"><!-- Columns rendered by JS --></main>
</div>

<!-- Task Detail Modal with Sub-tasks -->
<div class="gtd-modal-overlay" id="gtd-task-modal">
    <div class="gtd-modal-content">
        <button class="gtd-modal-close-btn">&times;</button>
        <h2 id="gtd-modal-title" class="gtd-modal-title"></h2>
        <label for="gtd-modal-duedate" class="gtd-modal-label">Due Date</label>
        <input type="date" id="gtd-modal-duedate" class="gtd-modal-duedate">
        <div class="gtd-modal-label">Category</div>
        <div id="gtd-category-selector" class="gtd-category-selector"></div>
        <label for="gtd-modal-notes" class="gtd-modal-label">Notes</label>
        <textarea id="gtd-modal-notes" class="gtd-modal-notes" placeholder="Add more details..."></textarea>
        <div class="gtd-modal-label">Sub-tasks</div>
        <div id="gtd-subtask-container">
            <ul class="gtd-subtask-list"></ul>
            <form class="gtd-add-subtask-form">
                <input type="text" placeholder="Add a new sub-task..." required>
                <button type="submit">+</button>
            </form>
        </div>
    </div>
</div>

<!-- Task Composer Modal -->
<div class="gtd-modal-overlay" id="gtd-composer-modal">
    <div class="gtd-modal-content">
        <button class="gtd-modal-close-btn">&times;</button>
        <input type="text" id="gtd-composer-task-name" placeholder="What needs to be done?" autocomplete="off">
        <div class="gtd-composer-pickers">
             <input type="date" id="gtd-composer-duedate" class="gtd-modal-duedate">
             <div id="gtd-composer-category-selector" class="gtd-category-selector"></div>
        </div>
        <div class="gtd-composer-options">
            <div class="gtd-composer-meta-buttons">
                <button id="gtd-composer-date-btn">Due Date</button>
                <button id="gtd-composer-category-btn">Category</button>
            </div>
            <button id="gtd-composer-add-btn" disabled>Add Task</button>
        </div>
    </div>
</div>

